<% provide(:title, '登録情報編集') %>

<div class="container">
  <h2 class="title">登録情報編集</h2>
  <%= form_for(@order, url: order_path(@order)) do |f| %>
  <div class="row order-row">
    <div class="col-sm-6 col-sm-offset-3">
      <%= render 'shared/error_messages', object: f.object %>
    </div>

    <div class="row row-order-form">
      <div class="col-sm-5">
        <%= f.label :name, '船名', class:'form-label-login', id: 'order-name-label' %>
        <%= f.text_field :name, placeholder: "入力してください", class: 'form-control', id: 'order-name' %>
        <div class=" form-group">
          <%= f.label :shipment_id, '入出荷', class:'form-label-login'%>
          <%= f.collection_select :shipment_id, @shipment, :id, :name,
                {selected: @order.shipment_id}, class: 'form-control' %>
        </div>
        <%= f.label :company_name, '取引先会社名', class:'form-label-login order-edit-alerm', id: 'order-company-name-label' %>
        <%= f.text_field :company_name, class: 'form-control', id:"order-company-name" %>
        <div class=" form-group">
          <%= f.label :facility_id, '対象設備', class:'form-label-login'%>
          <%= select_tag 'order[facility_id]', options_for_select(Facility.all.map{ |fa| [fa.name, fa.id] }), class:"form-control", id: 'facility-select' %>
        </div>
      </div>

      <div class=" col-sm-5">
        <div class=" form-group">
          <%= f.label :oil_id, '油種', class:'form-label-login'%>
          <select name="order[oil_id]" id="oil-select" class="form-control">
            <option value="<%= @order.oil.id %>"><%= @order.oil.name %></option>
          </select>
        </div>
        <div class="form-group">
          <%= f.label :unit, '数量・単位', class:'form-label-login', id: 'number-label' %>
          <div class="row">
            <div class="col-sm-7">
              <%= f.number_field :quantity, class: 'form-control', min: 1, id: "number" %>
            </div>
            <div class="col-sm-5">
              <%= f.select :unit, options_for_select([['kL'], ['t']]), {}, class: 'form-control' %>
            </div>
          </div>
        </div>
        <%= f.label :arrive_at, '荷役作業日時', class:'form-label-login'%>
        <div class="row">
          <div class="col-sm-7">
            <input class="form-control" type="date" name="order[arrive_at_date]" value="<%= @arrive_at_date %>">
          </div>
          <div class="col-sm-5 time">
            <%= f.time_select :arrive_at, minute_step: 10, class: 'form-control' %>
          </div>
        </div>
        <div class=" form-group">
          <%= f.label :user_id, '担当者', class:'form-label-login'%>
          <%= f.collection_select :user_id, User.all, :id, :name,
                                  {selected: @order.user.id}, class: 'form-control' %>
        </div>
      </div>
    </div>
  </div>

  <%= f.submit "編集", class: "btn btn-loggedIn col-sm-6 col-sm-offset-3", id:"order-edit-save" %>
  <% end %>
</div>

<script>
  $(function() {
    var category_id = '<%= current_user.category_id %>';
    $('#facility-select').change(function() {
      $.get({
        url: `/orders/oil`,
        data: {
          facility_id: $('#facility-select').has('option:selected').val()
        },
      })
    });
    $('#order-edit-save').attr('disabled', false);
    $('#order-name').keyup(function() {
      if (!$(this).val().trim()) {
        $('#order-edit-save').attr('disabled', true);
        $(this).css("border-color", "red");
        $("#order-name-label").css("color", "red");
        $("#order-name-label").html("船名<div style='float:right;margin-left:10px;font-size:13px;vertical-align: middle;'>※入力してください<div>");
      } else {
        $('#order-edit-save').attr('disabled', false);
        $(this).css("border-color", "");
        $("#order-name-label").css("color", "");
        $("#order-name-label").html("船名");
      }
    });
    $('#order-company-name').keyup(function() {
      if (!$(this).val().trim()) {
        $('#order-edit-save').attr('disabled', true);
        $(this).css("border-color", "red");
        $("#order-company-name-label").css("color", "red");
        $("#order-company-name-label").html("取引先会社名<div style='float:right;margin-left:10px;font-size:13px;vertical-align: middle;'>※入力してください<div>");
      } else {
        $('#order-edit-save').attr('disabled', false);
        $(this).css("border-color", "");
        $("#order-company-name-label").css("color", "");
        $("#order-company-name-label").html("取引先会社名");
      }
    });
    $('#number').keyup(function() {
      if (!$(this).val().trim()) {
        $('#order-edit-save').attr('disabled', true);
        $(this).css("border-color", "red");
        $("#number-label").css("color", "red");
        $("#number-label").html("数量・単位<div style='float:right;margin-left:10px;font-size:13px;vertical-align: middle;'>※入力してください<div>");
      } else {
        $('#order-edit-save').attr('disabled', false);
        $(this).css("border-color", "");
        $("#number-label").css("color", "");
        $("#number-label").html("数量・単位");
      }
    });
  });
</script>