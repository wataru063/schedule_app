<div class="modal fade" id="orderNewModal" tabindex="-1" role="dialog" aria-labelledby="basicModal" aria-hidden="true">
  <div class="modal-dialog" id="order-new-modal-dialog">
    <div class="modal-content" id="order-modal-content">
      <% if @order.present? %>
      <div class="modal-header" id="order-modal-header">
        <div class="modal-title order-modal-title" id="myModalLabel">
          オーダー登録
        </div>
        <button type="button" class="btn btn-default" data-dismiss="modal" style="float:right;">
          <i class="fa fa-2x fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <div class="order-new-content">
          <%= form_for(@order) do |f| %>
          <%= render 'shared/error_messages', object: f.object %><br>
          <div id="new-order-form">
            <div id="order-new-left">
              <%= f.label :name, '船名*', class:'form-label-login required-label', id: "o-new-name-label" %>
              <%= f.text_field :name, placeholder: "入力してください", class: 'form-control required', id: "o-new-name" %>

              <div class=" form-group">
                <%= f.label :shipment_id, '入出荷*', class:'form-label-login'%>
                <%= f.collection_select :shipment_id, Shipment.all, :id, :name, {}, class: 'form-control' %>
              </div>

              <%= f.label :company_name, '取引先会社名*', class:'form-label-login required-label', id: "o-new-companyname-label" %>
              <%= f.text_field :company_name, placeholder: "入力してください", class: 'form-control', id: "o-new-companyname" %>

              <div class=" form-group">
                <%= f.label :facility_id, '対象設備*', class:'form-label-login'%>
                <%= select_tag 'order[facility_id]', options_for_select(Facility.all.map{ |fa| [fa.name, fa.id] }), selected: @selected_facility, class:"form-control", id: 'facility-select' %>
              </div>
            </div>

            <div id="order-new-right">
              <div class=" form-group">
                <%= f.label :oil_id, '油種*', class:'form-label-login'%>
                <select name="order[oil_id]" id="oil-select" class="form-control">
                  <%= @selected_oils.each do |oil| %>
                  <option value="<%= oil.id %>" class="oil-option"><%= oil.name %></option>
                  <% end %>
                </select>
              </div>

              <div class="form-group">
                <%= f.label :unit, '数量・単位*', class:'form-label-login required-label', id: "number-label"%>
                <div class="row">
                  <div class="col-sm-7">
                    <%= f.number_field :quantity, placeholder: "入力してください", class: 'form-control required', min: 1, id: "number" %>
                  </div>
                  <div class="col-sm-5">
                    <%= f.select :unit, options_for_select([['kL'], ['t']]),
                                  {include_blank:  "-- 選択してください --"}, class: 'form-control' %>
                  </div>
                </div>
              </div>

              <%= f.label :arrive_at, '荷役作業日時*', class:'form-label-login'%>
              <div class="row">
                <div class="col-sm-7">
                  <input class="form-control" type="date" name="order[arrive_at_date]" value="<%= @arrive_at_date %>" style='width:285px;'>
                </div>
                <div class="col-sm-5 time">
                  <%= f.time_select :arrive_at, {default: Date.today + 8.hours, minute_step: 10}, class: 'form-control' %>
                </div>
              </div>

              <div class=" form-group">
                <%= f.label :user_id, '担当者*', class:'form-label-login'%>
                <%= f.collection_select :user_id, User.all, :id, :name,
                                  {include_blank: "-- 選択してください --", selected: current_user.id},
                                  class: 'form-control' %>
              </div>
            </div>
          </div>
          <%= f.submit "登録", class: "btn btn-loggedIn", id:"o-new-btn" %>
          <% end %>
        </div>
      </div>
      <% end %>
    </div>
  </div>
</div>

<script>
  $(function() {
    var category_id = '<%= current_user.category_id %>';
    $('#facility-select').change(function() {
      $.get({
        url: `/orders/oil`,
        data: {
          facility_id: $('#facility-select').has('option:selected').val()
        },
      })
    });
    $('#o-new-btn').attr('disabled', true);
    $('#o-new-name').keyup(function() {
      if (!$(this).val().trim()) {
        $('#o-new-btn').attr('disabled', true);
        $(this).css("border-color", "red")
        $("#o-new-name-label").css("color", "red")
        $("#o-new-name-label").html("船名*<div style='float:right;margin-left:10px;font-size:13px;vertical-align: middle;'>※入力してください<div>")
      } else {
        $('#o-new-btn').attr('disabled', false);
        $(this).css("border-color", "")
        $("#o-new-name-label").css("color", "")
        $("#o-new-name-label").html("船名*")
      }
    });
    $('#o-new-companyname').keyup(function() {
      if (!$(this).val().trim()) {
        $('#o-new-btn').attr('disabled', true);
        $(this).css("border-color", "red")
        $("#o-new-companyname-label").css("color", "red")
        $("#o-new-companyname-label").html("取引先会社名*<div style='float:right;margin-left:10px;font-size:13px;vertical-align: middle;'>※入力してください<div>")
      } else {
        $('#o-new-btn').attr('disabled', false);
        $(this).css("border-color", "")
        $("#o-new-companyname-label").css("color", "")
        $("#o-new-companyname-label").html("取引先会社名*")
      }
    });
    $('#number').keyup(function() {
      if (!$(this).val().trim()) {
        $('#o-new-btn').attr('disabled', true);
        $(this).css("border-color", "red")
        $("#number-label").css("color", "red")
        $("#number-label").html("数量・単位*<div style='float:right;margin-left:10px;font-size:13px;vertical-align: middle;'>※入力してください<div>")
      } else {
        $('#o-new-btn').attr('disabled', false);
        $(this).css("border-color", "")
        $("#number-label").css("color", "")
        $("#number-label").html("数量・単位*")
      }
    });
  });
</script>